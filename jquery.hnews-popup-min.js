if(!Array.prototype.forEach){Array.prototype.forEach=function(d,c){c=c||this;for(var b=0,a=this.length;b<a;b++){d.call(c,this[b],b,this)}}}if(typeof Prototype!="undefined"||!Array.prototype.map){Array.prototype.map=function(d,c){c=c||this;var e=[];for(var b=0,a=this.length;b<a;b++){e.push(d.call(c,this[b],b,this))}return e}}if(typeof Prototype!="undefined"||!Array.prototype.filter){Array.prototype.filter=function(d,c){c=c||this;var e=[];for(var b=0,a=this.length;b<a;b++){if(d.call(c,this[b],b,this)){e.push(this[b])}}return e}}["forEach","map","filter","slice","concat"].forEach(function(a){if(!Array[a]){Array[a]=function(b){return this.prototype[a].apply(b,Array.prototype.slice.call(arguments,1))}}});Date.ISO8601PartMap={Year:1,Month:3,Date:5,Hours:7,Minutes:8,Seconds:10};Date.matchISO8601=function(a){return a.match(/^(\d{4})(-?(\d{2}))?(-?(\d{2}))?(T(\d{2}):?(\d{2})(:?(\d{2}))?)?(Z?(([+\-])(\d{2}):?(\d{2})))?$/)};Date.parseISO8601=function(f){var c=this.matchISO8601(f);if(c){var b=new Date,a,d,e=0;for(var g in this.ISO8601PartMap){if(a=c[this.ISO8601PartMap[g]]){b["set"+g]((g=="Month")?parseInt(a,10)-1:parseInt(a,10))}else{b["set"+g]((g=="Date")?1:0)}}if(c[11]){e=(parseInt(c[14],10)*60)+parseInt(c[15],10);e*=((c[13]=="-")?1:-1)}e-=b.getTimezoneOffset();b.setTime(b.getTime()+(e*60*1000));return b}};Microformat={define:function(b,a){var c=function(d,e){this.parentElement=d;Microformat.extend(this,e)};c.container=b;c.format=a;c.prototype=Microformat.Base;return Microformat.extend(c,Microformat.SingletonMethods)},SingletonMethods:{discover:function(a){return Microformat.$$(this.container,a).map(function(b){return new this(b,this._parse(this.format,b))},this)},_parse:function(c,a){var b={};this._process(b,c.one,a,true);this._process(b,c.many,a);this._process_rel(b,c.rels,a);if(c.postprocess){c.postprocess(b,a)}return b},_process:function(d,e,a,c){var b,f;e=e||[];e.forEach(function(h){if(typeof h=="string"){b=Microformat.$$(h,a);if(c&&(f=b[0])){d[this._propFor(h)]=this._extractData(f,"simple",d)}else{if(b.length>0){d[this._propFor(h)+"List"]=b.map(function(i){return this._extractData(i,"simple",d)},this)}}}else{for(var g in h){b=Microformat.$$(g,a);if(c&&(f=b[0])){d[this._propFor(g)]=this._extractData(f,h[g],d)}else{if(b.length>0){d[this._propFor(g+"List")]=b.map(function(i){return this._extractData(i,h[g],d)},this)}}}}},this);return d},_process_rel:function(c,d,b){d=d||[];var a=this;d.forEach(function(e){c[a._propFor(e)+"List"]=Array.filter(b.getElementsByTagName("a"),function(f){return f.getAttribute("rel")==e}).map(function(f){return a._extractLink(f)})});return c},_extractData:function(c,b,d){if(b._parse){return b._parse(b.format,c)}if(typeof b=="function"){return b.call(this,c,d)}var a=Microformat.$$("value",c);if(a.length>0){return this._extractClassValues(c,a)}switch(b){case"simple":return this._extractSimple(c);case"url":return this._extractURL(c)}return this._parse(b,c)},_extractURL:function(b){var a;switch(b.nodeName.toLowerCase()){case"img":a=b.src;break;case"area":case"a":a=b.href;break;case"object":a=b.data}if(a){if(a.indexOf("mailto:")==0){a=a.replace(/^mailto:/,"").replace(/\?.*$/,"")}return a}return this._coerce(this._getText(b))},_extractLink:function(a){return{href:a.href,text:this._coerce(this._getText(a))}},_extractSimple:function(a){switch(a.nodeName.toLowerCase()){case"abbr":return this._coerce(a.title);case"img":return this._coerce(a.alt)}return this._coerce(this._getText(a))},_extractClassValues:function(d,a){var e=new String(a.map(function(f){return this._extractSimple(f)},this).join(""));var c=Microformat.$$("type",d);var b=c.map(function(f){return this._extractSimple(f)},this);e.types=b;return e},_getText:function(a){if(a.innerText){return a.innerText}return Array.map(a.childNodes,function(b){if(b.nodeType==3){return b.nodeValue}else{return this._getText(b)}},this).join("").replace(/\s+/g," ").replace(/(^\s+)|(\s+)$/g,"")},_coerce:function(c){var a,b;if(c=="true"){return true}if(c=="false"){return false}if(a=Date.parseISO8601(c)){return a}return String(c)},_propFor:function(a){this.__propCache=this.__propCache||{};if(prop=this.__propCache[a]){return prop}return this.__propCache[a]=a.replace(/(-(.))/g,function(){return arguments[2].toUpperCase()})},_handle:function(c,a,b){if(this.handlers[c]){this.handlers[c].call(this,a,b)}}},$$:function(h,f){f=f||document;var c;if(f==document||f.nodeType==1){if(typeof document.evaluate=="function"){var b=document.evaluate(".//*[contains(concat(' ', @class, ' '), ' "+h+" ')]",f,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var e=[];for(var d=0,a=b.snapshotLength;d<a;d++){e.push(b.snapshotItem(d))}return e}else{c=f.getElementsByTagName("*")}}else{c=f}var g=new RegExp("(^|\\s)"+h+"(\\s|$)");return Array.filter(c,function(i){return i.className.match(g)})},extend:function(a,b){for(var c in b){a[c]=b[c]}return a},Base:{}};var HCard=Microformat.define("vcard",{one:["bday","tz","sort-string","uid","class",{n:{one:["family-name","given-name","additional-name"],many:["honorific-prefix","honorific-suffix"]},geo:function(b){var a;if((b.nodeName.toLowerCase()=="abbr")&&(a=b.title.match(/^([\-\d\.]+);([\-\d\.]+)$/))){return{latitude:a[1],longitude:a[2]}}return this._extractData(b,{one:["latitude","longitude"]})},fn:function(c,d){var a,b=this._extractData(c,"simple");if(a=b.match(/^(\w+) (\w+)$/)){d.n=d.n||{};d.n.givenName=d.n.givenName||a[1];d.n.familyName=d.n.familyName||a[2]}if(a=b.match(/^(\w+),? (\w+)\.?$/)){d.n=d.n||{};d.n.givenName=d.n.givenName||a[2];d.n.familyName=d.n.familyName||a[1]}return b}}],many:["label","sound","title","role","key","mailer","rev","nickname","category","note","tel",{url:"url",logo:"url",photo:"url",email:"url"},{adr:{one:["post-office-box","extended-address","street-address","locality","region","postal-code","country-name"]},org:function(a){var b=this._extractData(a,{one:["organization-name"],many:["organization-unit"]});if(!b.organizationName){b.organizationName=this._extractData(a,"simple")}return b}}]});var Geo=Microformat.define("geo",{one:["latitude","longitude"]});var HNews=Microformat.define("hentry",{one:["entry-title","entry-summary","entry-content","published","updated",{"source-org":HCard},"dateline"],many:[{author:HCard},{geo:Geo}],rels:["principles","item-license","tag"],postprocess:function(e,d){if(e.published&&!e.updated){e.updated=e.published}if(e.tagList){for(var c in e.tagList){var b=e.tagList[c].href;var a=/[/]([^/]*)[/]?([?].*)?$/.exec(b);e.tagList[c].tag=unescape(a?a[1]:"")}}}});(function(a){a.fn.hnews_popup=function(b){b=a.extend({head_fn:function(){var d='<div class="hnews-popup-container">\n';d+=' <div class="hnews-popup">\n';d+='<h3 class="hnews-popup-heading">hNews details</h3>\n';d+="<table>\n";return d},foot_fn:function(){var d="</table>\n";d+="</div>\n";d+=" </div>\n";return d},row_fn:function(d,e){return' <tr><td class="hnews-popup-name">'+d+'</td><td class="hnews-popup-value">'+e+"</td></tr>\n"},fmt_hcard:function(d){if(d.url){return'<a href="'+d.url+'">'+d.fn+"</a>"}else{return d.fn}},fmt_link:function(e){var d=e.text||e.href;return'<a href="'+e.href+'">'+d+"</a>"},fmt_date:function(e){return e},fmt_geo:function(d){return"lat: "+d.latitude+" long: "+d.longitude+' (<a href="http://maps.google.com/?ll='+d.latitude+","+d.longitude+'">map</a>)'}},b);a(this).each(function(){var e=a(this);e.addClass("hnews-popup-trigger");var d=e.closest(".hentry");var h=HNews.discover(d);var f=b.head_fn();f+=c(h[0]);f+=b.foot_fn();var g=a(f);e.after(g);g.mouseleave(function(){g.hide()});e.mouseenter(function(){if(g.is(":hidden")){g.show();g.offset(e.offset())}})});function c(j){var i=b.row_fn;var h=b.fmt_link;var f=b.fmt_date;var g=b.fmt_geo;var e=b.fmt_hcard;out="";out+=i("Title",j.entryTitle);if(j.authorList){a.each(j.authorList,function(k,l){out+=i("Author",e(l))})}if(j.published){out+=i("Published",f(j.published))}if(j.updated){out+=i("Updated",f(j.updated))}if(j.sourceOrg){out+=i("Source organisation",e(j.sourceOrg))}if(j.dateline){out+=i("Dateline",j.dateline)}if(j.geoList){a.each(j.geoList,function(k,l){out+=i("Geo",g(l))})}if(j.principlesList){a.each(j.principlesList,function(k,l){out+=i("Principles",h(l))})}if(j.itemLicenseList){a.each(j.itemLicenseList,function(k,l){out+=i("License",h(l))})}if(j.tagList){var d=[];a.each(j.tagList,function(l,k){d.push(h({href:k.href,text:k.tag}))});out+=i("Tags",d.join(", "))}return out}}})(jQuery);